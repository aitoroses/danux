//Documente ready 
$(document).ready(function(){$(document).on("undo",function(){App.History.undoWardrobe();Tab6Controller.pintarMarco();Tab6Controller.KineticPintaPuertaMarco();WardrobeModel.save()});$(document).on("stack",function(){App.History.saveWardrobe()});$(document).bind("sync",function(){Tab6Controller.pintarMarco();Tab6Controller.KineticPintaPuertaMarco();$(document).trigger("stack")});$(document).bind("sync_popup",function(){});$(document).bind("sync_save",function(){Tab6Controller.pintarMarco();Tab6Controller.KineticPintaPuertaMarco()});$(document).bind("error",function(){$("#containeri").html("No se ha cargado el armario")});$("a.next-tab").on("click",function(e){e.preventDefault();App.Navigator.goNext()});$("a.prev-tab").on("click",function(e){App.Navigator.goBack()});WardrobeModel.fetch()});Tab6Controller={initialize:function(){},pintarMarco:function(){$("#marco_sel").html("&nbsp");$.ajax({type:"GET",url:"API/asides/getMarco",success:function(e){$("#marco_sel").append(e)}})},"añadirMarco":function(e){WardrobeModel.wardrobe.data.marco=e;WardrobeModel.save()},getMarcoMaterials:function(e){$.ajax({type:"GET",url:"API/popup/view/materialsView",data:{type:e},success:function(e){$("#materiales").html(e);$("#materiales .element").click(function(){$(document).trigger("stack");var e=$(this).data("id");Tab6Controller.añadirMarco(e);popup.closePopup()})}})},KineticPintaPuertaMarco:function(){layerp=new Kinetic.Layer;layerpi=new Kinetic.Layer;stagep.clear;document.getElementById("containerp").innerHTML="";wardrobe=WardrobeModel.getWardrobe();var e=wardrobe.modules.length;ancho=wardrobe.data.width*(666.8/4167);alto=wardrobe.data.height*.12;stagep=new Kinetic.Stage({container:"containerp",width:ancho,height:alto});pintamarco();ancho-=10;alto-=10;var t=5;e=wardrobe.doors.length;$.ajax({type:"GET",url:"content/door/",dataType:"json",async:!1,success:function(e){data=e}});for(x=0;x<e;x++){var n=5,r=data.types[x];xx=0;for(y=0;y<r.length;y++)(function(){var e=y,i=x;if(wardrobe.data.tperfil==1)var s=1;else if(wardrobe.data.tperfil==3)var s=0;else var s=3;var o=new Kinetic.Rect({x:t,y:n,width:ancho/wardrobe.doors.length,height:alto*r[e],stroke:"black",fill:"transparent",strokeWidth:s,name:"p"+i+"m"+e});if(wardrobe.doors[i].material.length!==0&&parseInt(wardrobe.doors[i].material[e])!=0){var u=t,a=n,f=alto*r[e],l=new Image;l.onload=function(){var t=new Kinetic.Image({x:u,y:a,width:ancho/wardrobe.doors.length,height:f,image:l,name:"image"+e});layerpi.add(t);layerpi.draw()};l.src=data.materials[i][0][xx];xx+=1}n+=alto*r[e];layerp.add(o)})();t+=ancho/wardrobe.doors.length}stagep.add(layerpi);stagep.add(layerp);stagep.draw();layerpi.draw();layerp.draw();var i=stagep.get(".image");i.each("moveToBottom",{})}};