//###################################################################  PINTA PUERTAS
function pintapuertas(){layerp=new Kinetic.Layer;layerpi=new Kinetic.Layer;stagep.clear;document.getElementById("containerp").innerHTML="";wardrobe=WardrobeModel.getWardrobe();var e=wardrobe.modules.length;ancho=wardrobe.data.width*(666.8/4167);alto=wardrobe.data.height*.12;stagep=new Kinetic.Stage({container:"containerp",width:ancho,height:alto});pintamarco();ancho-=10;alto-=10;var t=5;e=wardrobe.doors.length;$.ajax({type:"GET",url:"content/door/",dataType:"json",async:!1,success:function(e){data=e}});for(x=0;x<e;x++){var n=5,r=data.types[x];xx=0;for(y=0;y<r.length;y++)(function(){var e=y,i=x;if(wardrobe.data.tperfil==2)var s=4;else if(wardrobe.data.tperfil==3)var s=1;else var s=2;var o=new Kinetic.Rect({x:t,y:n,width:ancho/wardrobe.doors.length,height:alto*r[e],stroke:"black",fill:"transparent",strokeWidth:s,name:"p"+i+"m"+e});if(wardrobe.doors[i].material.length!=0&&parseInt(wardrobe.doors[i].material[e])!=0){var u=t,a=n,f=alto*r[e],l=new Image;l.onload=function(){var t=new Kinetic.Image({x:u,y:a,width:ancho/wardrobe.doors.length,height:f,image:l,name:"image"+e});layerpi.add(t);layerpi.draw()};l.src=data.materials[i][0][xx];xx+=1}n+=alto*r[e];o.on("click",function(e){var t=e.targetNode,n=t.getName(),r=materialselect.indexOf(n);r!=-1?materialselect.splice(r,1):materialselect.push(n);var t=e.targetNode,i=this.getStroke();canvasMessage.pinta_notifications();switch(i){case"red":if(colortemp=="black"){this.setStroke("orange");this.moveToTop();stagep.draw()}else if(colortemp=="red"){this.setStroke("orange");this.moveToTop();stagep.draw()}else{this.setStroke("red");colortemp="black";this.moveToBottom();stagep.draw()}break;case"orange":if(colortemp=="black"){this.setStroke("red");this.moveToTop();stagep.draw()}}});o.on("mouseout",function(e){var t=e.targetNode,n=t.getStroke();switch(n){case"red":this.setStroke(colortemp);this.moveToBottom();colortemp=="orange"?this.moveToTop():this.moveToBottom()}stagep.draw();layertext.draw()});o.on("mouseover",function(e){var t=e.targetNode,n=this.getStroke();colortemp=n;this.setStroke("red");this.moveToTop();stagep.draw()});layerp.add(o)})();t+=ancho/wardrobe.doors.length}stagep.add(layerpi);stagep.add(layerp);var i=stagep.get(".image");i.each("moveToBottom",{})}function pintamodulos(){layer=new Kinetic.Layer;layeri=new Kinetic.Layer;stage.clear;document.getElementById("containeri").innerHTML="";wardrobe=WardrobeModel.getWardrobe();var e=wardrobe.modules.length;ancho=wardrobe.data.width*(666.8/4167);alto=wardrobe.data.height*.12;stage=new Kinetic.Stage({container:"containeri",width:ancho,height:alto});ancho-=10;alto-=10;for(x=0;x<e;x++){var t=5;for(zz=0;zz<x;zz++)t+=wardrobe.modules[zz].width*(ancho/wardrobe.data.width);(function(){var e=x,n=new Kinetic.Rect({x:t,y:5,width:wardrobe.modules[e].width*(ancho/wardrobe.data.width),height:alto*anchoaltillo,stroke:"black",fill:"white",strokeWidth:3,name:"m"+e+"d"+0});layer.add(n)})();pintamoduloNormal(x,parseInt(wardrobe.modules[x].double),t)}stage.add(layeri);stage.add(layer);stage.draw();layeri.draw();layer.draw();var n=stage.get(".image");n.each("moveToBottom",{})}function pintamoduloNormal(e,t,n){var r=n,i=0,s=0,o=0,u=0;if(t==1)var a=wardrobe.modules[e].ddouble*(ancho/wardrobe.data.width),f=2;else var a=wardrobe.modules[e].width*(ancho/wardrobe.data.width),f=1;for(n=0;n<f;n++)(function(){var f=e,l=n+1,c=new Kinetic.Rect({x:r,y:5+alto*anchoaltillo,width:a,height:alto-alto*anchoaltillo,stroke:"black",fill:"transparent",strokeWidth:3,name:"m"+f+"d"+l});c.on("click",function(e){var t=e.targetNode,n=t.getName();moduleselect=n;anchuratemp=t.attrs.width;var r=getTab();double=WardrobeModel.wardrobe.modules[f].double;$.ajax({type:"POST",url:"API/session/double/"+double,async:!1,success:function(){if(r==3){popup.openPopup();popup.fetch({name:"agregar_accesorios_interior"})}else{popup.openPopup();popup.fetch({name:"modules"})}}})});c.on("mouseout",function(e){var t=e.targetNode,n=this.getStroke();switch(n){case"black":this.setStroke("orange");break;case"orange":this.setStroke("black")}this.moveToTop();stage.draw()});c.on("mouseover",function(e){var t=e.targetNode,n=this.getStroke();switch(n){case"black":this.setStroke("orange");break;case"orange":this.setStroke("black")}this.moveToTop();stage.draw()});layer.add(c);if(n==0&&parseInt(wardrobe.modules[f].ref1)!=0){i=r;o=a;var h=new Image;h.onload=function(){var e=new Kinetic.Image({x:i,y:5+alto*anchoaltillo,image:h,width:o,height:alto-alto*anchoaltillo,name:"image"});layeri.add(e);layeri.draw()};var p=wardrobe.modules[f].ref1;h.src="semiems/contenido/Bibliotecas/modulos/"+p+".png"}else if(n==1&&parseInt(wardrobe.modules[f].ref2)!=0){s=r;u=a;var d=new Image;d.onload=function(){var e=new Kinetic.Image({x:s,y:5+alto*anchoaltillo,image:d,width:u,height:alto-alto*anchoaltillo,name:"image2"});layeri.add(e);layeri.draw()};var p=wardrobe.modules[f].ref2;d.src="semiems/contenido/Bibliotecas/modulos/"+p+".png"}if(t==1){a=(wardrobe.modules[f].width-wardrobe.modules[f].ddouble)*(ancho/wardrobe.data.width);r+=wardrobe.modules[f].ddouble*(ancho/wardrobe.data.width)}})()}function pintamarco(){layerm=new Kinetic.Layer;wardrobe=WardrobeModel.getWardrobe();anchop=wardrobe.data.width*(666.8/4167);altop=wardrobe.data.height*.12;var e=new Kinetic.Rect({x:5,y:5,width:anchop-10,height:altop-10,stroke:"black",fill:"white",strokeWidth:0});if(wardrobe.data.marco!=0){var t=new Image;t.onload=function(){var n=new Kinetic.Image({x:0,y:0,image:t,width:anchop,height:altop,name:"image2"});layerm.add(n);layerm.add(e);stagep.add(layerm);stagep.draw();layerm.draw();layerm.moveToBottom()};var n=wardrobe.data.marco,r=$.ajax({type:"GET",url:"content/materialsource/"+n,async:!1,success:function(e){t.src=e}})}}canvasMessage=new Object({message:new Kinetic.Text,initialize:function(){},pinta_notifications:function(){layertext.destroy();layertext=new Kinetic.Layer;this.hline=new Kinetic.Line({points:[0,0,0,0],stroke:"black"});layertext.add(this.hline);this.vline=new Kinetic.Line({points:[0,0,0,0],stroke:"black"});layertext.add(this.vline);nmod=wardrobe.doors.length;for(x=0;x<materialselect.length;x++){var e=stagep.get("."+materialselect[x]);this.createMessage("add_X",e[0].getX(),e[0].getY(),e[0].getWidth(),e[0].getHeight());layertext.draw()}stagep.add(layertext);layertext.moveDown();stagep.draw()},createMessage:function(e,t,n,r,i){if(e=="add_door"){hline=new Kinetic.Line({points:[t+20,n+i/2,t+r-20,n+i/2],stroke:"black",strokeWidth:8});layertext.add(hline);vline=new Kinetic.Line({points:[t+r/2,n+i/2+r/2-20,t+r/2,n+i/2-r/2+20],stroke:"black",strokeWidth:8});layertext.add(vline)}else if(e=="add_X"){hline=new Kinetic.Line({points:[t+18,n+i/2+r/2-18,t+r-18,n+i/2-r/2+18],stroke:"black",strokeWidth:14});layertext.add(hline);vline=new Kinetic.Line({points:[t+r/2+r/2-18,n+i/2+r/2-18,t+r/2-r/2+18,n+i/2-r/2+18],stroke:"black",strokeWidth:14});layertext.add(vline);hline1=new Kinetic.Line({points:[t+20,n+i/2+r/2-20,t+r-20,n+i/2-r/2+20],stroke:"white",strokeWidth:8});layertext.add(hline1);vline1=new Kinetic.Line({points:[t+r/2+r/2-20,n+i/2+r/2-20,t+r/2-r/2+20,n+i/2-r/2+20],stroke:"white",strokeWidth:8});layertext.add(vline1)}}});